import t from"./timer.min.js";import e from"./json-storage.min.js";export default{name:"Game",data:()=>({player:"",cards:[],hits:0,errors:0,timer:{minutes:0,seconds:0},componentRefresh:0,url:{},jsonStorage:{}}),computed:{sec(){return(this.jsonStorage.set("timer.seconds",this.timer.seconds),this.timer.seconds<10)?"0"+this.timer.seconds:this.timer.seconds},min(){return(this.jsonStorage.set("timer.minutes",this.timer.minutes),this.timer.minutes<10)?"0"+this.timer.minutes:this.timer.minutes}},methods:{api:()=>({async getAnimals(){let t=await fetch("https://fed-team.modyo.cloud/api/content/spaces/animals/types/game/entries?"+new URLSearchParams({per_page:9}));if(!t.ok){let e=`An error has occured: ${t.status}`;throw Error(e)}return await t.json()}}),checkCards(t){let e=document.querySelectorAll(".flip-card-trigger:checked:not(:disabled)").length;if(e>2)return document.getElementById(t.target.id).checked=!1,!1;let s=parseInt(t.target.id.replace(/[^0-9]/g,""));if(this.cards[s].checked=!0,2===e){let r=this.cards.filter(t=>!0==t.checked&&!1==t.disabled);r[0].uuid===r[1].uuid?(this.hits++,this.jsonStorage.set("hits",this.hits),r[0].disabled=!0,r[1].disabled=!0):setTimeout(()=>{this.errors++,this.jsonStorage.set("errors",this.errors),r[0].checked=!1,r[1].checked=!1,this.jsonStorage.set("cards",this.cards)},800)}return 0===document.querySelectorAll(".flip-card-trigger:not(:checked)").length&&(setTimeout(()=>{document.getElementById("congrats").classList.add("is-active")},800),this.timer.stop()),this.jsonStorage.set("cards",this.cards),!0},restart(){this.hits=0,this.errors=0,this.timer.reset(),this.jsonStorage.clear(),this.cards.sort(()=>Math.random()-.5),this.cards.forEach(t=>{t.checked=!1,t.disabled=!1}),this.jsonStorage.set("cards",this.cards),this.componentRefresh++},playAgain(){this.restart(),document.getElementById("congrats").classList.remove("is-active"),this.timer.start()},newGame(){this.restart(),document.getElementById("congrats").classList.remove("is-active"),this.url.searchParams.delete("player"),window.history.replaceState(null,null,this.url),this.player="",this.start()},start(){this.player?(this.jsonStorage.set("player",this.player),this.url.searchParams.set("player",this.player),window.history.replaceState(null,null,this.url),this.timer.start(),document.getElementById("signin").classList.remove("is-active")):document.getElementById("signin").classList.add("is-active")}},mounted(){document.getElementById("loader").classList.remove("is-active"),this.start()},created(){this.jsonStorage=new e(window.localStorage),["player","cards","hits","errors","timer.seconds","timer.minutes"].forEach(t=>{if(void 0===this.jsonStorage.get(t))this.jsonStorage.set(t,this[t]);else{let e=t.split(".");e.length>1?this[e[0]][e[1]]=this.jsonStorage.get(t):this[t]=this.jsonStorage.get(t)}}),this.url=new URL(document.location),this.player=this.url.searchParams.get("player"),this.timer=new t(this.timer),this.cards.length>0&&this.jsonStorage.get("player")&&this.player!=this.jsonStorage.get("player")&&this.restart(),0===this.cards.length&&this.api().getAnimals().then(t=>{let e=[];t.entries.forEach((t,s)=>{e.push(Object.assign(t.fields.image,{checked:!1,disabled:!1}))}),this.cards=e.concat(structuredClone(e)).sort(()=>Math.random()-.5),this.jsonStorage.set("cards",this.cards)}).catch(t=>window.alert(t.message))}};